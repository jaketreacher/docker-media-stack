version: '3'
services:
  plex:
    image: plexinc/pms-docker:latest
    container_name: plex
    network_mode: host
    volumes:
      - ${CONFIG_DIR:?}/plex:/config
      - ${MEDIA_DIR:?}:/media
      - ${TRANSCODE_DIR:?}:/transcode
    env_file: ./.env
    restart: unless-stopped

  tautulli:
    image: tautulli/tautulli:latest
    container_name: tautulli
    ports:
      - 8181:8181
    volumes:
      - ${CONFIG_DIR:?}/tautulli:/config
      - ${CONFIG_DIR:?}/plex/Library/Application\ Support/Plex\ Media\Server/Logs/:/plex_logs:ro
    env_file: ./.env
    restart: unless-stopped

  watchtower:
    image: v2tec/watchtower:latest
    container_name: watchtower
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command: -s "0 0 3 * * *" --cleanup
    env_file: ./.env
    restart: unless-stopped
